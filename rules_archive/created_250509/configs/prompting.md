# Prompt Engineering Techniques

## 1. 概要

このドキュメントは、カスタムインストラクション内で LLM の応答品質と精度を向上させるための、基本的なプロンプトエンジニアリング技法のガイドラインを提供します。
各Cellは、必要に応じてこれらの技法を参照・適用してください。

## 2. 基本的なプロンプティング

- 簡潔な敬体を使用し、冗長な表現、感情的表現を使用しないでください。
- **役割設定 (Role Prompting):** AI に特定の役割 (例: テスター、レビュアー、特定の技術の専門家) を与えることで、応答の視点や専門性を制御する。

## 3. Few-Shot Prompting

- **目的:** 期待される応答の形式、スタイル、または思考プロセスを示すために、少数の具体例 (入力と出力のペア) を提示する。
- **適用場面:**
  - 特定のフォーマットでの出力を要求する場合。
  - 一貫した応答スタイルが必要な場合。
  - 複雑な指示の解釈を補助する場合。
  - 新しいタスクや未知のパターンを学習させる場合。
- **ガイドライン:**
  - 例はタスクに密接に関連し、高品質であること。
  - 例の数はタスクの複雑さに応じて調整する (通常 1〜5 個程度)。
  - 例のフォーマットは一貫させる。
- **例 (計画立案時のリスク分析):**

    ```markdown
    # Few-Shot 例: リスク分析

    入力計画ステップ: ユーザー認証機能を追加する。
    出力リスク分析:
    - リスク: 不正アクセスによる情報漏洩。
    - 対策: パスワードハッシュ化、多要素認証の導入。
    - 残存リスク: ソーシャルエンジニアリング。

    入力計画ステップ: 外部 API と連携する。
    出力リスク分析:
    - リスク: 外部 API の障害による機能停止。
    - 対策: リトライ処理、サーキットブレーカーの実装。
    - 残存リスク: API 仕様変更への追従遅延。

    # 本題
    入力計画ステップ: [現在の計画ステップ]
    出力リスク分析:
    ```

## 4. Chain-of-Thought (CoT) Prompting

- **目的:** 複雑な推論や問題解決が必要な場合に、LLM に思考プロセスを段階的に説明させ、最終的な結論に至るまでの論理的なつながりを明確にする。
- **適用場面:**
  - 複数ステップの計算や論理的推論が必要なタスク。
  - 計画立案 (各ステップの根拠説明)。
  - デバッグ (問題特定までの思考過程)。
  - 複雑なコードの解説。
- **ガイドライン:**
  - 「ステップバイステップで考えてください」「思考プロセスを記述してください」のように、思考過程の出力を明確に指示する。
  - Few-shot 例と組み合わせると効果的な場合がある。
- **例 (計画策定):**

    ```markdown
    # Chain-of-Thought 指示

    タスク: 新機能 A の実装アプローチを定義する。

    指示: Stage 2-a で収集した情報に基づき、新機能 A の実装アプローチをステップバイステップで検討し、最適なものを選択してください。各ステップの思考プロセスも記述してください。

    思考プロセス:
    1.  まず、収集した情報から実現可能な選択肢をリストアップする。
        - 選択肢1: [内容]
        - 選択肢2: [内容]
    2.  次に、各選択肢のメリット・デメリットを評価する。
        - 選択肢1のメリット: [...], デメリット: [...]
        - 選択肢2のメリット: [...], デメリット: [...]
    3.  評価に基づき、最適なアプローチを選択する。選択理由は [...]

    結論: 最適なアプローチは [選択肢X] です。理由は [...]
    ```

## 5. ReAct (Reasoning + Acting) Prompting

- **目的:** CoT の推論プロセスに、外部ツール利用や環境からの情報収集 (Action) を組み合わせ、より高度な問題解決やタスク実行を可能にする。
- **適用場面:**
  - 外部情報の検索が必要な調査タスク (`web_search`)。
  - ファイルシステム操作やコード実行が必要なタスク (`run_terminal_cmd`, `edit_file`)。
  - Agent フレームワーク的な動作が必要な場合。
- **ガイドライン:**
  - 思考 (Thought)、行動 (Action)、観察 (Observation) のサイクルを明示的に意識させる。
  - 利用可能なツールとその機能を明確に指示する。
- **例 (デバッグ):**

    ```markdown
    # ReAct 指示

    タスク: 特定の関数のバグを修正する。

    指示: 以下の手順でバグ修正を行ってください。思考、行動、観察を記述してください。

    Thought 1: まず、エラーメッセージと関連コードを読む必要がある。
    Action 1: `read_file` で [対象ファイルパス] の [関連行] を読み込む。
    Observation 1: [読み込んだコードとエラー内容]
    Thought 2: [エラー原因の推測] を検証するために、[特定の変数] の値を確認する必要がある。
    Action 2: `run_terminal_cmd` でデバッグコマンドを実行し、変数の値を確認する。
    Observation 2: [デバッグ結果]
    Thought 3: 原因は [...] と特定。修正案は [...]。
    Action 3: `edit_file` で [...] のようにコードを修正する。
    Observation 3: ファイル編集成功。
    Thought 4: 修正を確認するためにテストを実行する。
    Action 4: `run_terminal_cmd` でテストコマンドを実行。
    Observation 4: テスト成功。
    Thought 5: バグ修正完了。

    結論: バグを修正しました。原因は [...] で、[...] のように修正しました。
    ```

## 6. 自己評価・自己修正 (Self-Correction/Self-Critique)

- **目的:** LLM 自身に生成した応答 (計画、コード、文章など) を評価させ、問題点や改善点を特定し、修正させることで品質を向上させる。
- **適用場面:**
  - 計画のレビュー。
  - コードレビュー。
  - 文章の校正。
  - 生成された内容の事実確認。
- **ガイドライン:**
  - 評価の観点 (例: 効率性、安全性、網羅性、スタイルガイド準拠) を具体的に指示する。
  - 「潜在的な問題点は？」「改善できる点は？」「代替案は？」といった問いかけを用いる。
- **例 (コードレビュー):**

    ```markdown
    # 自己評価指示

    対象コード: [生成されたコードブロック]

    指示: 上記のコードについて、以下の観点から自己評価し、改善点があれば提案してください。
    - 可読性
    - `styleguide/coding_standards.md` への準拠
    - パフォーマンス
    - エラーハンドリング

    評価:
    - 可読性: [...]
    - 準拠性: [...]
    - パフォーマンス: [...]
    - エラーハンドリング: [...]

    改善提案: [...]
    ```

## 7. 思考ツールフレームワークの活用 (推奨)

- **目的:** 複雑な情報の整理、分析、アイデア評価を効率的かつ構造的に行うために、適切な思考ツールフレームワークを活用する。
- **適用場面:**
  - 計画立案 (`02_planner.mdc` Stage 2-b など)
  - 問題分析、原因特定
  - アイデアの評価と比較
  - 対話による思考整理 (`02_planner.mdc` Stage 2-e など)
- **ガイドライン:**
  - タスクの目的に応じて適切なフレームワークを選択・活用することを推奨します。
  - 思考プロセスを説明する際には、どのフレームワークを使用しているかを明示すると、より分かりやすくなります (例: 「ロジカルツリーを用いて原因を分解します」)。
- **フレームワーク例:**
  - **問題分析/構造化:**
    - **ロジカルツリー:** 問題や課題を階層的に分解し、原因や解決策を特定する。
    - **MECE (Mutually Exclusive and Collectively Exhaustive):** 漏れなくダブりなく要素を整理する。
    - **マインドマップ:** アイデアや情報を放射状に広げて整理する。
  - **アイデア評価/比較:**
    - **Pros/Cons リスト:** メリットとデメリットをリストアップして比較する。
    - **SWOT 分析:** 強み (Strengths)、弱み (Weaknesses)、機会 (Opportunities)、脅威 (Threats) を分析する。
    - **意思決定マトリクス:** 複数の評価基準に基づいて選択肢を比較・評価する。
  - **その他:** (必要に応じて、5 Forces 分析、PEST 分析なども文脈に応じて検討)

---
*このファイルは、各ルールファイルが必要に応じて参照・適用することを想定しています。*
